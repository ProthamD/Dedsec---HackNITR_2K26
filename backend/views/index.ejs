<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventree - AI Inventory Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        :root {
            --bg-primary: hsl(240, 6%, 10%);
            --bg-card: hsl(240, 5%, 12%);
            --border: hsl(240, 4%, 20%);
            --text-primary: hsl(0, 0%, 98%);
            --text-muted: hsl(240, 5%, 64%);
            --accent-green: hsl(142, 70%, 45%);
            --chat-user: hsl(240, 4%, 18%);
            --chat-ai: hsl(240, 5%, 14%);
        }
        body { background: var(--bg-primary); color: var(--text-primary); }
        .gradient-mesh {
            background: radial-gradient(at 40% 20%, hsla(142, 70%, 45%, 0.1) 0px, transparent 50%),
                        radial-gradient(at 80% 0%, hsla(240, 5%, 20%, 0.5) 0px, transparent 50%),
                        radial-gradient(at 0% 50%, hsla(142, 70%, 45%, 0.05) 0px, transparent 50%);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation Bar -->
    <nav class="fixed top-0 left-0 right-0 z-50 px-4 py-3" style="background: hsla(240, 5%, 12%, 0.8); backdrop-filter: blur(24px); border-bottom: 1px solid var(--border);">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="/" class="flex items-center gap-2 text-xl font-bold" style="color: var(--text-primary); text-decoration: none;">
                <span>üì¶</span>
                <span>Inven<span style="color: var(--accent-green);">tree</span></span>
            </a>
            <div class="flex items-center gap-3">
                <a href="/profile" class="flex items-center gap-2 px-4 py-2 rounded-lg transition-all hover:bg-opacity-10" style="color: var(--text-muted); text-decoration: none; border: 1px solid var(--border);">
                    <i data-feather="user" style="width: 18px; height: 18px;"></i>
                    <span class="hidden sm:inline">Profile</span>
                </a>
                <a href="/logout" onclick="return confirm('Are you sure you want to logout?')" class="flex items-center gap-2 px-4 py-2 rounded-lg transition-all" style="background: rgba(239, 68, 68, 0.1); color: rgb(239, 68, 68); text-decoration: none; border: 1px solid rgba(239, 68, 68, 0.3);">
                    <i data-feather="log-out" style="width: 18px; height: 18px;"></i>
                    <span class="hidden sm:inline">Logout</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Add padding to account for fixed nav -->
    <div style="padding-top: 60px;">
    
    <% if (!hasInventory) { %>
        <!-- No Inventory State -->
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="text-center">
                <div class="text-6xl mb-4">üì¶</div>
                <h2 class="text-2xl font-semibold mb-2" style="color: var(--text-primary);">No Inventory Data</h2>
                <p class="mb-6" style="color: var(--text-muted);">Add inventory items to get started</p>
                <a href="/inventory/add" class="inline-flex items-center px-6 py-3 rounded-lg font-medium transition-colors" style="background: var(--accent-green); color: var(--text-primary);">
                    Add Inventory
                </a>
            </div>
        </div>
    <% } else { %>
        <!-- Hero Header -->
        <section class="flex flex-col items-center justify-center px-4 py-12 gradient-mesh relative">
            <!-- Background Decoration -->
            <div class="absolute inset-0 overflow-hidden pointer-events-none">
                <div class="absolute top-20 left-10 w-72 h-72 rounded-full blur-3xl" style="background: hsla(142, 70%, 45%, 0.05);"></div>
                <div class="absolute bottom-20 right-10 w-96 h-96 rounded-full blur-3xl" style="background: hsla(142, 70%, 45%, 0.03);"></div>
            </div>

            <!-- Header -->
            <div class="text-center relative z-10">
                <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold mb-4">
                    <span style="color: var(--text-primary);">Inven</span><span style="color: var(--accent-green);">tree</span>
                </h1>
                <p class="text-xl md:text-2xl mb-6" style="color: var(--text-muted);">
                    Inventory Management
                </p>
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full" style="background: hsla(240, 5%, 12%, 0.5); border: 1px solid var(--border);">
                    <span class="text-sm" style="color: var(--accent-green);">‚ú®</span>
                    <span class="text-sm" style="color: var(--text-muted);">AI-Powered Assistant</span>
                </div>
            </div>
        </section>

        <!-- Management Center Section -->
        <% if (hasInventory) { %>
            <%- include('management', { issues: issues, issueCount: issueCount, inventoryCount: inventoryCount }) %>
        <% } %>

        <!-- Chat Section -->
        <section class="flex flex-col items-center justify-center px-4 py-8" style="border-top: 1px solid var(--border);">
            <!-- Chat Container -->
            <div class="w-full max-w-3xl relative z-10">
                <div class="rounded-2xl shadow-2xl overflow-hidden" style="background: hsla(240, 5%, 12%, 0.8); backdrop-filter: blur(24px); border: 1px solid var(--border);">
                    <!-- Chat Messages -->
                    <div id="chatMessages" class="h-[300px] overflow-y-auto p-6 space-y-4">
                        <!-- Bot Welcome Message -->
                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded-lg flex items-center justify-center shrink-0" style="background: var(--chat-ai);">
                                <svg class="w-4 h-4" style="color: var(--text-muted);" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13 7H7v6h6V7z"/>
                                    <path fill-rule="evenodd" d="M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="px-4 py-3 rounded-2xl rounded-bl-md max-w-[80%]" style="background: var(--chat-ai);">
                                <p class="text-sm leading-relaxed" style="color: var(--text-primary);">
                                    Hello! I'm your Inventory AI Assistant. I can help you manage stock levels, track items, reduce waste, and automate inventory tasks. What would you like to do today?
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div class="p-4" style="border-top: 1px solid var(--border);">
                        <div class="flex gap-3">
                            <input 
                                type="text" 
                                id="messageInput" 
                                placeholder="Ask about inventory, stock levels, or automation..."
                                onkeypress="handleKeyPress(event)"
                                class="flex-1 px-4 py-3 rounded-lg text-sm focus:outline-none" 
                                style="background: hsla(240, 5%, 12%, 0.5); border: 1px solid var(--border); color: var(--text-primary);"
                            >
                            <button 
                                onclick="sendMessage()" 
                                id="sendBtn"
                                class="p-3 rounded-lg transition-all"
                                style="background: var(--accent-green); color: var(--text-primary); box-shadow: 0 0 20px hsla(142, 70%, 45%, 0.3);"
                            >
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Warehouse Communication Section -->
        <section class="px-4 py-16" style="background: var(--bg-card); border-top: 1px solid var(--border);">
            <div class="max-w-6xl mx-auto">
                <!-- Section Header -->
                <div class="mb-8 text-center">
                    <h2 class="text-2xl md:text-3xl font-bold mb-2" style="color: var(--text-primary);">
                        üè≠ Warehouse Network
                    </h2>
                    <p style="color: var(--text-muted);">
                        Request or transfer inventory between warehouses to optimize stock levels
                    </p>
                </div>

                <!-- Two Column Layout -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Request Stock Column -->
                    <div class="rounded-xl p-6" style="background: var(--bg-primary); border: 1px solid var(--border);">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2" style="color: var(--accent-green);">
                            <i data-feather="inbox" class="w-5 h-5"></i>
                            Request Stock
                        </h3>
                        
                        <!-- Request Form -->
                        <div class="space-y-3 mb-6">
                            <input 
                                type="text" 
                                id="requestProduct" 
                                placeholder="Product SKU or Name"
                                class="w-full px-4 py-2 rounded-lg text-sm focus:outline-none" 
                                style="background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary);"
                            >
                            <input 
                                type="number" 
                                id="requestQuantity" 
                                placeholder="Quantity needed"
                                min="1"
                                class="w-full px-4 py-2 rounded-lg text-sm focus:outline-none" 
                                style="background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary);"
                            >
                            <select 
                                id="requestWarehouse" 
                                class="w-full px-4 py-2 rounded-lg text-sm focus:outline-none" 
                                style="background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary);">
                                <option value="">Select requesting warehouse</option>
                                <option value="wh-boston">Boston Distribution Center</option>
                                <option value="wh-atlanta">Atlanta Warehouse</option>
                                <option value="wh-chicago">Chicago Hub</option>
                                <option value="wh-dallas">Dallas Center</option>
                                <option value="wh-la">Los Angeles Facility</option>
                            </select>
                            <button 
                                onclick="createStockRequest()"
                                class="w-full px-4 py-3 rounded-lg font-medium transition-all hover:scale-102"
                                style="background: var(--accent-green); color: var(--bg-primary);">
                                üì® Create Request
                            </button>
                        </div>

                        <!-- Active Requests -->
                        <div class="space-y-3">
                            <h4 class="text-sm font-semibold mb-2" style="color: var(--text-muted);">Active Requests</h4>
                            <div id="activeRequests" class="space-y-2 max-h-[300px] overflow-y-auto">
                                <div class="p-3 rounded-lg text-center" style="background: var(--bg-card); color: var(--text-muted); font-size: 0.85em;">
                                    No active requests
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Available for Transfer Column -->
                    <div class="rounded-xl p-6" style="background: var(--bg-primary); border: 1px solid var(--border);">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2" style="color: var(--accent-green);">
                            <i data-feather="package" class="w-5 h-5"></i>
                            Available for Transfer
                        </h3>
                        
                        <!-- Excess Stock Items -->
                        <div id="excessStock" class="space-y-2 max-h-[450px] overflow-y-auto">
                            <div class="p-3 rounded-lg text-center" style="background: var(--bg-card); color: var(--text-muted); font-size: 0.85em;">
                                Loading inventory...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transfer History -->
                <div class="mt-6 rounded-xl p-6" style="background: var(--bg-primary); border: 1px solid var(--border);">
                    <h3 class="text-lg font-semibold mb-4 flex items-center gap-2" style="color: var(--text-primary);">
                        <i data-feather="repeat" class="w-5 h-5"></i>
                        Recent Transfers
                    </h3>
                    <div id="transferHistory" class="space-y-2 max-h-[200px] overflow-y-auto">
                        <div class="p-3 rounded-lg text-center" style="background: var(--bg-card); color: var(--text-muted); font-size: 0.85em;">
                            No transfer history
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Hidden input for userId -->
        <input type="hidden" id="userId" value="<%= userId %>">
    <% } %>
    
    </div> <!-- Close padding div -->

    <script src="/js/chat.js"></script>
    <script src="/js/warehouse-network.js"></script>
    <script>
        // Initialize feather icons for navigation
        if (typeof feather !== 'undefined') {
            feather.replace();
        }
    </script>
</body>
</html>
